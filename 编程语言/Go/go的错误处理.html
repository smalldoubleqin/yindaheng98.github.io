<!DOCTYPE html><html class="html-loading"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Goçš„é”™è¯¯å¤„ç† | Howard-Blogs</title><meta name="author" content="Howard Yin"><meta name="keywords" content><meta name="description" content><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="/css/Annie.css"><script src="/js/jquery.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script><script src="/js/leancloud.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css"></head><body><div id="preloader"><div class="pre-container"><div class="spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div></div><header class="fixbackground" data-img-mode="normal" data-normal-src="/img/1.jpg" data-random-max="110" data-random-src="https://sariay.github.io/Random-img/"><div class="mask"><div class="h-header"><div id="logo"><a href="/"><img src="/img/logo.png" alt="Logo"></a></div><div id="navigation-show"><ul><li class="menu-home"><a href="/" class="menu-item-home">ä¸»é¡µ</a></li><li class="menu-archive"><a href="/archives" class="menu-item-archive">å½’æ¡£</a></li><li class="menu-categories"><a href="/categories" class="menu-item-categories">åˆ†ç±»</a></li><li class="menu-tags"><a href="/tags" class="menu-item-tags">æ ‡ç­¾</a></li><li class="menu-about"><a href="/about" class="menu-item-about">å…³äº</a></li><li class="menu-gallery"><a href="/gallery" class="menu-item-gallery">ç›¸å†Œ</a></li></ul></div></div><div class="h-body"><p class="motto"></p></div><div class="h-footer"><a href="javascript:;" id="read-more"><i class="fa fa-angle-double-down" aria-hidden="true"></i></a><style type="text/css">.header-date{font-size:1.6rem;color:#fff;position:absolute;bottom:5px;right:1rem;writing-mode:tb-rl}.header-date a{border-bottom:none}@media only screen and (max-width:768){.header-date{font-size:1rem}}</style><div class="header-date"><a href="https://time.is/Beijing" id="time_is_link" rel="nofollow"></a> <span id="Beijing_z43d"></span></div><script src="//widget.time.is/zh.js"></script><script>time_is_widget.init({Beijing_z43d:{template:"DATE",date_format:"yearå¹´ monthnumæœˆ dnumæ—¥"}})</script></div></div></header><div id="navigation-hide"><div id="progress-bar"></div><div id="progress-percentage"><h1>0.0%</h1></div><div class="toc-switch"><span class="switch-button">ç›®å½•</span></div><p>å½“å‰æ–‡ç« &nbsp;:&nbsp;ã€ŠGoçš„é”™è¯¯å¤„ç†ã€‹</p><a class="nav-trigger"><span></span></a></div><nav class="nav-container" id="cd-nav"><div class="nav-header"><h3>Navigation</h3><a href="javascript:;" class="nav-close"></a></div><div class="nav-body"><ul><li class="menu-home"><a href="/" class="menu-item-home">ä¸»é¡µ</a></li><li class="menu-archive"><a href="/archives" class="menu-item-archive">å½’æ¡£</a></li><li class="menu-categories"><a href="/categories" class="menu-item-categories">åˆ†ç±»</a></li><li class="menu-tags"><a href="/tags" class="menu-item-tags">æ ‡ç­¾</a></li><li class="menu-about"><a href="/about" class="menu-item-about">å…³äº</a></li><li class="menu-gallery"><a href="/gallery" class="menu-item-gallery">ç›¸å†Œ</a></li></ul></div><div class="nav-footer"><ul><li><a href="http://github.com/yindaheng98" target="_blank"><i class="fa fa-github"></i></a></li><li><a href="http://github.com/yindaheng98" target="_blank"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/yindaheng98" target="_blank"><i class="fa fa-pinterest"></i></a></li><li><a href="http://github.com/yindaheng98" target="_blank"><i class="fa fa-instagram"></i></a></li><li><a href="http://github.com/yindaheng98" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li></ul></div></nav><main><div class="layout-toc"><div id="layout-toc"><div class="k-catelog-list" id="catelog-list" data-title="æ–‡ç« ç›®å½•"></div></div></div><script src="/plugin/toc/katelog.min.js"></script><div class="layout-post"><div id="layout-post"><div class="article-title"><i class="fa fa-paper-plane-o" aria-hidden="true"></i> <a href="/ç¼–ç¨‹è¯­è¨€/Go/goçš„é”™è¯¯å¤„ç†.html" itemprop="url">Goçš„é”™è¯¯å¤„ç†</a></div><div class="article-meta"><span><i class="fa fa-calendar"></i> å‘å¸ƒäº <a href="/ç¼–ç¨‹è¯­è¨€/Go/goçš„é”™è¯¯å¤„ç†.html" itemprop="url"><time datetime="2019-10-21T01:45:33.000Z" itemprop="datePublished">2019-10-21 </time></a>&nbsp; æ›´æ–°äº <a href="/ç¼–ç¨‹è¯­è¨€/Go/goçš„é”™è¯¯å¤„ç†.html" itemprop="url"><time datetime="2019-10-21T01:45:33.000Z" itemprop="dateUpdated">2020-06-24</time></a> </span><span><i class="fa fa-tags"></i> <a href="/tags/Go/">Go</a></span></div><div class="article-content" id="article-content"><p>Go è¯­è¨€é€šè¿‡å†…ç½®çš„é”™è¯¯æ¥å£æä¾›äº†éå¸¸ç®€å•çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚<br>errorç±»å‹æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</span><br><span class="line">    Error() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è¾“å‡ºé”™è¯¯ç”¨å†…ç½®çš„<code>errors.New</code></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sqrt</span><span class="params">(f <span class="keyword">float64</span>)</span> <span class="params">(<span class="keyword">float64</span>, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> f &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">"ä¸èƒ½å¯¹è´Ÿæ•°å¼€æ–¹"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å®ç°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ•è·é”™è¯¯</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">result, err:= Sqrt(<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">   fmt.Println(err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="deferè¯­å¥"><a class="markdownIt-Anchor" href="#deferè¯­å¥"></a> deferè¯­å¥</h2><ul><li><code>defer</code>å…³é”®å­—åå¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼ˆå¿…é¡»æ˜¯<code>defer func(å½¢å‚){}(å®å‚)</code>æˆ–è€…<code>defer func å‡½æ•°å(å®å‚)</code>è€Œä¸èƒ½æ˜¯<code>defer func(){}</code>ï¼‰ã€‚</li><li><code>defer</code>è¯­å¥ä¼šå°†å‡½æ•°æ¨è¿Ÿåˆ°å¤–å±‚å‡½æ•°è¿”å›ä¹‹åæ‰§è¡Œã€‚</li></ul><p>æ¨è¿Ÿè°ƒç”¨çš„å‡½æ•°å…¶<strong>è¾“å…¥å‚æ•°ä¼šç«‹å³æ±‚å€¼</strong>ï¼ˆå³ä½¿deferä¹‹åå‚æ•°å‘ç”Ÿä¿®æ”¹ï¼Œå¯¹å·²ç»deferçš„å‡½æ•°æ²¡æœ‰å½±å“ï¼‰ï¼Œä½†<strong>ç›´åˆ°å¤–å±‚å‡½æ•°è¿”å›å‰è¯¥å‡½æ•°éƒ½ä¸ä¼šè¢«è°ƒç”¨</strong>ã€‚</p><p>æ¨è¿Ÿçš„å‡½æ•°è°ƒç”¨ä¼šè¢«å‹å…¥ä¸€ä¸ªæ ˆä¸­ã€‚å½“å¤–å±‚å‡½æ•°è¿”å›æ—¶ï¼Œè¢«æ¨è¿Ÿçš„å‡½æ•°ä¼šæŒ‰ç…§<strong>åè¿›å…ˆå‡º</strong>çš„é¡ºåºè°ƒç”¨ã€‚</p><h3 id="è¦ç‚¹"><a class="markdownIt-Anchor" href="#è¦ç‚¹"></a> è¦ç‚¹</h3><ul><li>æ³¨æ„ï¼Œ<code>defer</code>åé¢çš„è¯­å¥ä¸­åªæœ‰æœ€å¤–å±‚çš„å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ï¼Œå…¶ä»–çš„éƒ½æ˜¯ç«‹å³è°ƒç”¨ï¼Œä¾‹å¦‚è¿è¡Œä¸‹é¢è¿™ä¸ªç¨‹åºï¼š</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">defer_a</span><span class="params">(v <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">   fmt.Println(<span class="string">"defer_a("</span>+v+<span class="string">")"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">defer_b</span><span class="params">(v <span class="keyword">string</span>)</span><span class="title">string</span></span>&#123;</span><br><span class="line">   s:=<span class="string">"defer_b("</span>+v+<span class="string">")"</span></span><br><span class="line">   fmt.Println(s)</span><br><span class="line">   <span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fa</span><span class="params">()</span></span>&#123;</span><br><span class="line">   fmt.Println(<span class="string">"before defer"</span>)</span><br><span class="line">   <span class="keyword">defer</span> defer_a(defer_b(defer_b(<span class="string">"hahaha"</span>)))</span><br><span class="line">   fmt.Println(<span class="string">"after defer"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fa()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†ä¼šè¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">before defer</span><br><span class="line">defer_b(hahaha)</span><br><span class="line">defer_b(defer_b(hahaha))</span><br><span class="line">after defer</span><br><span class="line">defer_a(defer_b(defer_b(hahaha)))</span><br></pre></td></tr></table></figure><p>å³<code>defer defer_a(defer_b(defer_b(&quot;hahaha&quot;)))</code>ä¸­çš„<code>defer_b(defer_b(&quot;hahaha&quot;))</code>åœ¨<code>defer</code>å¤„æ±‚å€¼ï¼Œè€Œæœ€å¤–å±‚çš„<code>defer_a</code>åˆ™åœ¨å‡½æ•°è¿”å›åæ‰æ±‚å€¼ã€‚</p><ul><li>åœ¨å‡½æ•°<code>return</code>è¯­å¥ä¹‹å<code>defer</code>ä¸ä¼šå¯¼è‡´å‡½æ•°è¿”å›åæ±‚å€¼ï¼Œæ¯”å¦‚ï¼š</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fb</span><span class="params">(v <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">   <span class="keyword">defer</span> fmt.Println(<span class="string">"run "</span>+v+<span class="string">" defer before"</span>)</span><br><span class="line">   <span class="keyword">if</span> v==<span class="string">"b"</span>&#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">defer</span> fmt.Println(<span class="string">"run "</span>+v+<span class="string">" defer after"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fb(<span class="string">"a"</span>)</span><br><span class="line">  fb(<span class="string">"b"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šè¿”å›ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run a defer after</span><br><span class="line">run a defer before</span><br><span class="line">run b defer before</span><br></pre></td></tr></table></figure><p>å³åœ¨è¾“å…¥<code>b</code>æ—¶å‡½æ•°<code>fb</code>çš„åœ¨ç¬¬äºŒä¸ª<code>defer</code>å‰è¿”å›ï¼Œå› æ­¤ç¬¬äºŒä¸ª<code>defer</code>æ²¡æœ‰æ‰§è¡Œã€‚è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œå…¶å®<code>defer</code>å°±æ˜¯ä¸€ä¸ªå’Œé€’å½’å‡½æ•°ä¸€æ ·çš„å‹æ ˆæ“ä½œï¼Œåªä¸è¿‡å‹åˆ°ä¸€ä¸ªgoè¯­è¨€è®¾è®¡çš„ä¸“ç”¨çš„æ ˆé‡Œé¢ï¼Œåœ¨<code>defer</code>ä¹‹å‰å°±é€€å‡ºæ‰§è¡Œç›¸å½“äºå‹æ ˆæ“ä½œæ²¡æœ‰æ‰§è¡Œï¼Œè‡ªç„¶ä¹Ÿå°±ä¸ä¼šåœ¨<code>return</code>åæ‰§è¡Œè¿™ä¸ª<code>defer</code>é‡Œçš„å‡½æ•°ã€‚</p><h3 id="ç”¨é€”æ¸…ç†é‡Šæ”¾èµ„æº"><a class="markdownIt-Anchor" href="#ç”¨é€”æ¸…ç†é‡Šæ”¾èµ„æº"></a> ç”¨é€”ï¼šæ¸…ç†é‡Šæ”¾èµ„æº</h3><p>ç”±äº defer çš„å»¶è¿Ÿç‰¹æ€§ï¼Œdefer å¸¸ç”¨åœ¨å‡½æ•°è°ƒç”¨ç»“æŸä¹‹åæ¸…ç†ç›¸å…³çš„èµ„æºï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   f1, _ := os.Open(filename)</span><br><span class="line">   <span class="keyword">defer</span> f1.Close()</span><br><span class="line">   f2, _ := os.Open(filename)</span><br><span class="line">   <span class="keyword">defer</span> f2.Close()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ä¸¤ä¸ªå…³é—­æ–‡ä»¶æ“ä½œä¼šåœ¨å‡½æ•°è¿”å›ä¹‹åæŒ‰ç…§<code>f2.Close()</code>-&gt;<code>f1.Close()</code>çš„é¡ºåºè¢«è°ƒç”¨ã€‚è¿™ç§ç”¨æ³•å¯ä»¥ç›´æ¥å°†é‡Šæ”¾èµ„æºçš„ä»£ç å†™åœ¨åˆ›å»ºèµ„æºçš„ä»£ç ä¸‹é¢ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½è®°ä½æœ‰å“ªäº›èµ„æºè¦é‡Šæ”¾ã€‚</p><h3 id="ç”¨é€”æ‰§è¡Œ-recover"><a class="markdownIt-Anchor" href="#ç”¨é€”æ‰§è¡Œ-recover"></a> ç”¨é€”ï¼šæ‰§è¡Œ recover</h3><p>è¢« defer çš„å‡½æ•°åœ¨ return ä¹‹åæ‰§è¡Œï¼Œè¿™ä¸ªæ—¶æœºç‚¹æ­£å¥½å¯ä»¥æ•è·å‡½æ•°æŠ›å‡ºçš„ panicï¼Œå› è€Œ defer çš„å¦ä¸€ä¸ªé‡è¦ç”¨é€”å°±æ˜¯æ‰§è¡Œ recoverã€‚</p><h3 id="ç”¨é€”ä¿®æ”¹å‡½æ•°çš„è¿”å›å€¼ä¸å¸¸ç”¨"><a class="markdownIt-Anchor" href="#ç”¨é€”ä¿®æ”¹å‡½æ•°çš„è¿”å›å€¼ä¸å¸¸ç”¨"></a> ç”¨é€”ï¼šä¿®æ”¹å‡½æ•°çš„è¿”å›å€¼ï¼ˆä¸å¸¸ç”¨ï¼‰</h3><p>deferè¿˜å¯ä»¥ç”¨äºåœ¨returnä¹‹åä¿®æ”¹è¿”å›å€¼ï¼Œè¿™æ˜¯deferçš„å®ç°æœºåˆ¶èµ‹äºˆçš„èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œåœ¨å¼€å¤´é‡Œé¢è¯´çš„é‚£ä¸ªä¾‹å­ä¸­ï¼Œå‡½æ•°<code>fa</code>å¯ä»¥ç­‰ä»·äºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fa</span><span class="params">()</span></span>&#123;</span><br><span class="line">   fmt.Println(<span class="string">"before defer"</span>)</span><br><span class="line">   v:=defer_b(defer_b(<span class="string">"hahaha"</span>))</span><br><span class="line">   fmt.Println(<span class="string">"after defer"</span>)</span><br><span class="line">   defer_a(v)</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å³deferçš„å®é™…æ‰§è¡Œå…¶å®æ˜¯åœ¨å…¶ä»–ä»£ç å’Œreturnä¹‹é—´ï¼Œä¸returnç´§è´´ã€‚åˆæ¯”å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sum</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">(v <span class="keyword">int</span>)</span>)</span> &#123;</span><br><span class="line">        sum += c</span><br><span class="line">    &#125;(<span class="number">1</span>)</span><br><span class="line">    sum = a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨<code>Sum</code>è¾“å‡ºçš„ç»“æœæ˜¯<code>a+b+1</code>ï¼Œå› ä¸ºå®ƒå¯ä»¥å†™æˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Sum</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="params">(sum <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">   v:=<span class="number">1</span></span><br><span class="line">   sum = a + b</span><br><span class="line">   sum += c</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¤æ‚ä¸€ç‚¹çš„é”™è¯¯å¤„ç†"><a class="markdownIt-Anchor" href="#å¤æ‚ä¸€ç‚¹çš„é”™è¯¯å¤„ç†"></a> å¤æ‚ä¸€ç‚¹çš„é”™è¯¯å¤„ç†</h2><p>æœ‰äº†ä¸Šé¢çš„å¸¸è§„é”™è¯¯å¤„ç†å’Œdeferçš„é“ºå«ï¼Œæ¥ä¸‹æ¥å¯ä»¥å¼€å§‹å­¦ä¹ <code>panic</code>å’Œ<code>recover</code>æœºåˆ¶çš„é”™è¯¯å¤„ç†äº†ã€‚<code>panic</code>å’Œ<code>recover</code>æœºåˆ¶ï¼š</p><p><code>panic</code>ç›¸å½“äºåœ¨å‡½æ•°è¿”å›å’Œ<code>defer</code>å‡½æ•°å¼€å§‹å‡ºæ ˆæ‰§è¡Œä¹‹å‰åŠ å…¥ä¸€ä¸ªæ ‡è®°ç„¶åç«‹å³è®©å‡½æ•°è¿”å›å¹¶ä¸”ç›´æ¥è¿›å…¥<code>defer</code>å‡ºæ ˆæ‰§è¡Œé˜¶æ®µï¼Œè€Œ<code>defer</code>é‡Œé¢çš„<code>recover()</code>å¯ä»¥æ•è·åˆ°è¿™ä¸ªæ ‡è®°ï¼Œå¹¶å°†ä»–è¿”ç»™æŸä¸ªå˜é‡ï¼Œå¦‚æœ<code>recover</code>æ²¡æœ‰æ•è·åˆ°æ ‡è®°å°±è¿”å›<code>nil</code>ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">except</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="built_in">recover</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">"before panic"</span>)</span><br><span class="line">   <span class="keyword">defer</span> except()</span><br><span class="line">   <span class="built_in">panic</span>(<span class="string">"test panic"</span>)</span><br><span class="line">   fmt.Println(<span class="string">"after panic"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å†™æˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">except</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="built_in">recover</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">"before panic"</span>)</span><br><span class="line">   <span class="keyword">defer</span> except()</span><br><span class="line">   å¼‚å¸¸=<span class="string">"test panic"</span></span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">   fmt.Println(<span class="string">"after panic"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿›è€Œå¯ä»¥å†™æˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">"before panic"</span>)</span><br><span class="line">   å¼‚å¸¸=<span class="string">"test panic"</span></span><br><span class="line">   fmt.Println(å¼‚å¸¸)</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">   fmt.Println(<span class="string">"after panic"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤è°ƒç”¨<code>test()</code>ä¼šè¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">before panic</span><br><span class="line">test panic</span><br></pre></td></tr></table></figure><h3 id="è¦ç‚¹-2"><a class="markdownIt-Anchor" href="#è¦ç‚¹-2"></a> è¦ç‚¹</h3><h4 id="panicä¸ä¼šå‘deferå†…ä¼ é€’"><a class="markdownIt-Anchor" href="#panicä¸ä¼šå‘deferå†…ä¼ é€’"></a> <code>panic</code>ä¸ä¼šå‘<code>defer</code>å†…ä¼ é€’</h4><p>è¿™ç‚¹å’Œæ­£å¸¸çš„å˜é‡ä¸åŒï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">   a:=<span class="number">1</span></span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">         fmt.Println(a)</span><br><span class="line">         fmt.Println(<span class="built_in">recover</span>())</span><br><span class="line">      &#125;()</span><br><span class="line">      <span class="function"><span class="keyword">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">         fmt.Println(a)</span><br><span class="line">         fmt.Println(<span class="built_in">recover</span>())</span><br><span class="line">      &#125;()</span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="built_in">panic</span>(<span class="string">"hahaha"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   test()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šè¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">&lt;nil&gt;</span><br><span class="line">1</span><br><span class="line">&lt;nil&gt;</span><br><span class="line">panic: hahaha</span><br><span class="line"></span><br><span class="line">goroutine 1 [running]:</span><br><span class="line">main.test()</span><br><span class="line">   /tmp/sandbox416292788/prog.go:16 +0x60</span><br><span class="line">main.main()</span><br><span class="line">   /tmp/sandbox416292788/prog.go:19 +0x20</span><br></pre></td></tr></table></figure><p>è¿™è¡¨æ˜é‚£ä¸ªåµŒå¥—çš„<code>defer</code>é‡Œé¢èƒ½çœ‹åˆ°å˜é‡<code>a</code>è€Œçœ‹ä¸åˆ°å¤–é¢çš„<code>panic</code>ã€‚å› æ­¤ï¼Œ<code>recover</code>åªæœ‰åœ¨å’Œ<code>panic</code>åœ¨åŒä¸€å‡½æ•°çš„ç¬¬ä¸€å±‚<code>defer</code>é‡Œé¢æ‰ä¼šç”Ÿæ•ˆã€‚ä»»ä½•å‡½æ•°çš„è°ƒç”¨éƒ½ä¼šæ¸…é™¤<code>panic</code>ï¼ˆ<strong>æ–°æ¥çš„äºº(panicä¹‹åçš„å‡½æ•°è°ƒç”¨)ä¸å¯èƒ½é€ æˆåœ¨å®ƒæ¥ä¹‹å‰å°±å­˜åœ¨çš„é”™è¯¯ï¼Œå› æ­¤æ˜¯æ— ç½ªçš„</strong>ï¼‰ã€‚</p><h4 id="åœ¨deferé‡Œé¢å†æŠ›å‡ºpanicä¼šå‘ç”Ÿä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#åœ¨deferé‡Œé¢å†æŠ›å‡ºpanicä¼šå‘ç”Ÿä»€ä¹ˆ"></a> åœ¨<code>defer</code>é‡Œé¢å†æŠ›å‡º<code>panic</code>ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h4><p>åªæœ‰æœ€é‡Œé¢çš„<code>panic</code>ä¼šè¢«æ•è·ï¼ˆå¦‚æœæœ‰<code>recover</code>åœ¨æ­£ç¡®çš„ä½ç½®çš„è¯ï¼‰ã€‚æŒ‰ç…§ä¸Šä¸€æ¡è§„åˆ™è‡ªå·±é¢†æ‚Ÿã€‚</p><h4 id="panicä¸ä»…ä¼šå¯¼è‡´è°ƒç”¨å®ƒçš„å‡½æ•°é€€å‡ºè¿˜ä¼šä¸€è·¯è¿å¸¦ç€ä¸Šå±‚è°ƒç”¨æ ˆä¸€å±‚å±‚å…¨éƒ¨é€€å‡º"><a class="markdownIt-Anchor" href="#panicä¸ä»…ä¼šå¯¼è‡´è°ƒç”¨å®ƒçš„å‡½æ•°é€€å‡ºè¿˜ä¼šä¸€è·¯è¿å¸¦ç€ä¸Šå±‚è°ƒç”¨æ ˆä¸€å±‚å±‚å…¨éƒ¨é€€å‡º"></a> <code>panic</code>ä¸ä»…ä¼šå¯¼è‡´è°ƒç”¨å®ƒçš„å‡½æ•°é€€å‡ºï¼Œè¿˜ä¼šä¸€è·¯è¿å¸¦ç€ä¸Šå±‚è°ƒç”¨æ ˆä¸€å±‚å±‚å…¨éƒ¨é€€å‡º</h4><p>è¿™æ—¶<code>panic</code>ä¼šæ²¿ç€ä¸Šå±‚è°ƒç”¨æ ˆé‡Œé¢å®šä¹‰çš„<code>defer</code>ä¸€è·¯ä¼ æ’­ç›´åˆ°é‡åˆ°ä¸€ä¸ª<code>recover</code>ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸ªä¾‹å­ä¸­ï¼Œè¦æ•è·é‚£ä¸ª<code>panic</code>é™¤äº†å¯ä»¥å°†<code>recover</code>å†™åœ¨ç¬¬ä¸€å±‚<code>func</code>é‡Œé¢ä¹‹å¤–ï¼Œè¿˜å¯ä»¥å†™æˆè¿™æ ·ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span> <span class="params">()</span></span>&#123;</span><br><span class="line">      fmt.Println(<span class="built_in">recover</span>())<span class="comment">//å¯ä»¥æ•è·</span></span><br><span class="line">   &#125;()</span><br><span class="line">   test()</span><br><span class="line">   fmt.Println(<span class="string">"after panic"</span>)<span class="comment">//ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¼šè¾“å‡ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line">&lt;<span class="literal">nil</span>&gt;</span><br><span class="line"><span class="number">1</span></span><br><span class="line">&lt;<span class="literal">nil</span>&gt;</span><br><span class="line">hahaha</span><br></pre></td></tr></table></figure><p>å³<code>panic</code>æ²¿ç€è°ƒç”¨æ ˆçš„<code>defer</code>ä¸€è·¯ä¼ äº†å‡ºæ¥ï¼Œå¹¶ä¸”ä¸»å‡½æ•°åœ¨<code>test()</code>å¤„å°±å› ä¸º<code>panic</code>é€€å‡ºäº†ï¼Œåé¢çš„<code>fmt.Println(&quot;after panic&quot;)</code>ä¸ä¼šæ‰§è¡Œã€‚ï¼ˆ<strong>åœ¨é”™è¯¯å‘ç”Ÿä¹‹å‰å°±åœ¨çš„äºº(panicä¹‹å‰çš„å‡½æ•°è°ƒç”¨)éƒ½æœ‰å¯èƒ½æ˜¯é”™è¯¯çš„å…ƒå‡¶ï¼Œéƒ½æ˜¯æœ‰ç½ªçš„</strong>ï¼‰</p><h4 id="å½“panicæ²¿ç€è°ƒç”¨æ ˆçš„deferä¼ å‡ºæ¥çš„è·¯ä¸Šå‡ºç°äº†æ–°çš„panicé‚£ä¹ˆrecoveråªæ•è·åˆ°æœ€åçš„panicç¦»ä»–æœ€è¿‘çš„"><a class="markdownIt-Anchor" href="#å½“panicæ²¿ç€è°ƒç”¨æ ˆçš„deferä¼ å‡ºæ¥çš„è·¯ä¸Šå‡ºç°äº†æ–°çš„panicé‚£ä¹ˆrecoveråªæ•è·åˆ°æœ€åçš„panicç¦»ä»–æœ€è¿‘çš„"></a> å½“<code>panic</code>æ²¿ç€è°ƒç”¨æ ˆçš„<code>defer</code>ä¼ å‡ºæ¥çš„è·¯ä¸Šå‡ºç°äº†æ–°çš„<code>panic</code>ï¼Œé‚£ä¹ˆ<code>recover</code>åªæ•è·åˆ°æœ€åçš„<code>panic</code>ï¼ˆç¦»ä»–æœ€è¿‘çš„ï¼‰ã€‚</h4><h4 id="goroutineå‘ç”Ÿpanicæ—¶åªä¼šè°ƒç”¨è‡ªèº«çš„defer"><a class="markdownIt-Anchor" href="#goroutineå‘ç”Ÿpanicæ—¶åªä¼šè°ƒç”¨è‡ªèº«çš„defer"></a> goroutineå‘ç”Ÿpanicæ—¶ï¼Œåªä¼šè°ƒç”¨è‡ªèº«çš„defer</h4><p>æ‰€ä»¥å³ä¾¿ä¸»goroutineé‡Œå†™äº†recoveré€»è¾‘ï¼Œä¹Ÿæ— æ³•æ‹¯æ•‘åˆ°å…¶å®ƒgoroutineé‡Œçš„panicã€‚goroutineä¸­çš„panicä¼šç›´æ¥å¯¼è‡´æ•´ä¸ªè¿›ç¨‹é€€å‡ºã€‚</p><p>è¿™ä¹Ÿæ˜¯goroutineèº«ä¸ºgoè¯­è¨€æ ¸å¿ƒæŠ€æœ¯å´åœ¨å®é™…ä»£ç ä¸­ä½¿ç”¨ä¸å¤šçš„åŸå› ã€‚</p><h3 id="é‡è¦ç”¨é€”å‘ç”Ÿé”™è¯¯æ—¶ä¹Ÿèƒ½æ­£å¸¸é‡Šæ”¾èµ„æº"><a class="markdownIt-Anchor" href="#é‡è¦ç”¨é€”å‘ç”Ÿé”™è¯¯æ—¶ä¹Ÿèƒ½æ­£å¸¸é‡Šæ”¾èµ„æº"></a> é‡è¦ç”¨é€”ï¼šå‘ç”Ÿé”™è¯¯æ—¶ä¹Ÿèƒ½æ­£å¸¸é‡Šæ”¾èµ„æº</h3><p>è¿™ä¸ªå¾ˆç®€å•ä½†å¾ˆé‡è¦ï¼Œçœ‹ä¸‹é¢è¿™ä¸ªå°±çŸ¥é“äº†ï¼š</p><p>æ¯”å¦‚åœ¨Cè¯­è¨€é‡Œé¢æœ‰ä¸€ä¸ªçº¿ç¨‹é”è¢«è¿™æ ·ç”¨äº†ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mu.Lock()</span><br><span class="line"><span class="comment">//æŸäº›æ“ä½œ</span></span><br><span class="line"><span class="keyword">throw</span>(<span class="comment">/*æŸäº›é”™è¯¯*/</span>)</span><br><span class="line"><span class="comment">//æŸäº›æ“ä½œ</span></span><br><span class="line">mu.Unlock()</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨é”çš„ä¸­é—´æŠ›å‡ºé”™è¯¯çš„æ—¶å€™ï¼Œ<code>mu</code>ä¸èƒ½æ­£å¸¸è§£é”ï¼Œå¯¼è‡´æ­»é”ã€‚</p><p>ä½†æ˜¯åœ¨goé‡Œé¢å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mu.Lock()</span><br><span class="line"><span class="keyword">defer</span> mu.Unlock()</span><br><span class="line"><span class="comment">//æŸäº›æ“ä½œ</span></span><br><span class="line"><span class="built_in">panic</span>(<span class="comment">/*æŸäº›é”™è¯¯*/</span>)</span><br><span class="line"><span class="comment">//æŸäº›æ“ä½œ</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå³ä½¿<code>panic</code>é€ æˆå‡½æ•°é€€å‡ºï¼Œ<code>defer</code>å®šä¹‰çš„è§£é”æ“ä½œä¹Ÿèƒ½æ‰§è¡Œï¼Œä»è€Œé¿å…äº†æ­»é”ã€‚</p><h3 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“"></a> æ€»ç»“</h3><p>è¿™é‡Œå¼•ç”¨goå®˜æ–¹æ•™ç¨‹çš„é”™è¯¯ç¤ºèŒƒåšä¸ªæ€»ç»“ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"7:"</span>, <span class="built_in">recover</span>())<span class="comment">//æ— æ•ˆï¼Œæ²¡æœ‰å’Œpanicåœ¨åŒä¸€å‡½æ•°çš„ç¬¬ä¸€å±‚deferé‡Œ</span></span><br><span class="line">         &#125;()</span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"6:"</span>, <span class="built_in">recover</span>())<span class="comment">//æ— æ•ˆï¼Œå‡½æ•°çš„è°ƒç”¨æ¸…é™¤äº†panic</span></span><br><span class="line">      &#125;()</span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">"1:"</span>, <span class="built_in">recover</span>())<span class="comment">//æ— æ•ˆï¼ŒæŒ‰ç…§è§„åˆ™ï¼Œåœ¨å¤–å±‚å‡½æ•°é€€å‡ºdeferæ‰§è¡Œçš„è§„åˆ™ï¼Œé‡Œé¢è¿™ä¸ªå‡½æ•°ä¼šç«‹å³è¢«æ‰§è¡Œï¼Œè¿™æ—¶è¿˜æ²¡æœ‰ä»»ä½•panicäº§ç”Ÿ</span></span><br><span class="line">      &#125;()</span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> fmt.Println(<span class="string">"2:"</span>, <span class="built_in">recover</span>())<span class="comment">//æ— æ•ˆï¼Œç†ç”±åŒä¸Š</span></span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"3:"</span>, <span class="built_in">recover</span>())<span class="comment">//æ— æ•ˆï¼Œdeferéƒ½æ²¡æœ‰ï¼Œå¦¥å¦¥çš„ç«‹å³æ‰§è¡Œï¼Œè¿™æ—¶è¿˜æ²¡æœ‰ä»»ä½•panicäº§ç”Ÿ</span></span><br><span class="line">   &#125;()</span><br><span class="line">   fmt.Println(<span class="string">"4:"</span>, <span class="built_in">recover</span>())<span class="comment">//æ— æ•ˆï¼Œç†ç”±åŒä¸Š</span></span><br><span class="line">   <span class="keyword">defer</span> fmt.Println(<span class="string">"5:"</span>, <span class="built_in">recover</span>())<span class="comment">//æ— æ•ˆï¼Œrecover()ç”šè‡³è¢«ç«‹å³æ±‚å€¼äº†</span></span><br><span class="line">   <span class="built_in">panic</span>(<span class="number">789</span>)</span><br><span class="line">   <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"0:"</span>, <span class="built_in">recover</span>())</span><br><span class="line">   &#125;()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div id="current-post-cover" data-scr="/img/cart_cover.jpg"></div><div class="investment-container"><div class="investment-header"><div class="investment-title-1"><div class="on">ç›¸å…³æ–‡ç« </div><div>è¯„è®º</div><div>åˆ†äº«</div></div><div class="investment-title-2"><span><a href="javascript: window.scrollTo(0, 0);">è¿”å›é¡¶éƒ¨</a> <a href="/æ•°æ®åº“/BloomFilter.html" title="Bloom Filterï¼šå¸ƒéš†è¿‡æ»¤å™¨" rel="prev">&laquo;ä¸Šä¸€ç¯‡ </a><a href="/ç¼–ç¨‹è¯­è¨€/Go/goçš„é¢å‘å¯¹è±¡.html" title="Goçš„é¢å‘å¯¹è±¡" rel="next">ä¸‹ä¸€ç¯‡&raquo;</a></span></div></div><div class="investment-content"><div class="investment-content-list"><div class="relate-post"><ul><li><div class="relate-post-text"><a class="relate-post-title" href="/ç¼–ç¨‹è¯­è¨€/Tex/Texå†å².html" title="TEXå†å²">TEXå†å²</a><p class="relate-post-date"><i class="fa fa-calendar"></i> å…­æœˆ 24æ—¥, 2020</p><p class="relate-post-content">å‚è€ƒèµ„æ–™å‚è€ƒèµ„æ–™ èµ·æºKnuth æœ€æ—©æ˜¯åœ¨ä¸€å° DEC PDP-11 ä¸Šç”¨ä¸€ç§å«åš SAIL çš„è¯­è¨€ç¼–å†™çš„ TeXï¼Œå°”åä»–å’Œä¸€äº›åˆä½œè€…ï¼Œå¼€å§‹åœ¨ Stanford å¤§å­¦å®éªŒä¸€ç§å«åš literate programming (æ–‡å­¦ç¼–ç¨‹)...</p></div><div class="relate-post-cover"><a href="/ç¼–ç¨‹è¯­è¨€/Tex/Texå†å².html" title="TEXå†å²"><img class="lazy" src="/img/placeholder.jpg" data-src="/img/cart_cover.jpg" alt="TEXå†å²"></a></div></li><li><div class="relate-post-text"><a class="relate-post-title" href="/ç¼–ç¨‹è¯­è¨€/Go/goçš„åå°„.html" title="(æœªå®Œæˆ)goçš„åå°„">(æœªå®Œæˆ)goçš„åå°„</a><p class="relate-post-date"><i class="fa fa-calendar"></i> å››æœˆ 7æ—¥, 2020</p><p class="relate-post-content">goçš„åå°„æ¨¡å‹åœ¨Golangå®ç°çš„åå°„ä¸­ï¼Œinterface{}å˜é‡å¯ä»¥çœ‹ä½œä¸€ä¸ªâ€œpairâ€ï¼Œâ€œpairâ€ä¸­è®°å½•äº†å®é™…å˜é‡çš„å€¼å’Œç±»å‹ï¼š(value, type)ï¼Œvalueè®°å½•äº†å˜é‡çš„å€¼ï¼Œtypeè®°å½•äº†å˜é‡çš„ç±»å‹ã€‚è¿™ä¸ªâ€œpairâ€åœ¨...</p></div><div class="relate-post-cover"><a href="/ç¼–ç¨‹è¯­è¨€/Go/goçš„åå°„.html" title="(æœªå®Œæˆ)goçš„åå°„"><img class="lazy" src="/img/placeholder.jpg" data-src="/img/cart_cover.jpg" alt="(æœªå®Œæˆ)goçš„åå°„"></a></div></li><li><div class="relate-post-text"><a class="relate-post-title" href="/ç¼–ç¨‹è¯­è¨€/Tex/LaTeXåŸºç¡€.html" title="LaTeXåŸºç¡€">LaTeXåŸºç¡€</a><p class="relate-post-date"><i class="fa fa-calendar"></i> å››æœˆ 2æ—¥, 2020</p><p class="relate-post-content">å‚è€ƒèµ„æ–™ï¼šLaTeX vs. MiKTeX: The levels of TeXdoc ã€ltxdoc ä¸ docstrip The levels of TeX â€”â€” TeXç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„å‘è¡Œç‰ˆï¼šTeX Liveã€MiKTeXã€CTe...</p></div><div class="relate-post-cover"><a href="/ç¼–ç¨‹è¯­è¨€/Tex/LaTeXåŸºç¡€.html" title="LaTeXåŸºç¡€"><img class="lazy" src="/img/placeholder.jpg" data-src="/img/cart_cover.jpg" alt="LaTeXåŸºç¡€"></a></div></li><li><div class="relate-post-text"><a class="relate-post-title" href="/ç¼–ç¨‹è¯­è¨€/Tex/æ–‡å­¦ç¼–ç¨‹.html" title="æ–‡å­¦ç¼–ç¨‹ï¼ˆLiterate Programmingï¼‰">æ–‡å­¦ç¼–ç¨‹ï¼ˆLiterate Programmingï¼‰</a><p class="relate-post-date"><i class="fa fa-calendar"></i> å››æœˆ 1æ—¥, 2020</p><p class="relate-post-content">æ­£å¦‚ Donald Ervin Knuth æ‰€æ„æƒ³çš„é‚£æ ·ï¼Œæ–‡å­¦ç¼–ç¨‹èŒƒå‹ä¸åŒäºä¼ ç»Ÿçš„ç”±è®¡ç®—æœºå¼ºåŠ çš„ç¼–å†™ç¨‹åºçš„æ–¹å¼å’Œé¡ºåºï¼Œè€Œä»£ä¹‹ä»¥è®©ç¨‹åºå‘˜ç”¨ä»–ä»¬è‡ªå·±æ€ç»´å†…åœ¨çš„é€»è¾‘å’Œæµç¨‹æ‰€è¦æ±‚çš„é¡ºåºå¼€å‘ç¨‹åºã€‚â€”â€”ç»´åŸºç™¾ç§‘graph LR foo.w...</p></div><div class="relate-post-cover"><a href="/ç¼–ç¨‹è¯­è¨€/Tex/æ–‡å­¦ç¼–ç¨‹.html" title="æ–‡å­¦ç¼–ç¨‹ï¼ˆLiterate Programmingï¼‰"><img class="lazy" src="/img/placeholder.jpg" data-src="/img/cart_cover.jpg" alt="æ–‡å­¦ç¼–ç¨‹ï¼ˆLiterate Programmingï¼‰"></a></div></li><li><div class="relate-post-text"><a class="relate-post-title" href="/ç¼–ç¨‹è¯­è¨€/Tex/TeXåŸºç¡€.html" title="TEXåŸºç¡€">TEXåŸºç¡€</a><p class="relate-post-date"><i class="fa fa-calendar"></i> å››æœˆ 1æ—¥, 2020</p><p class="relate-post-content">TEXå‘½ä»¤è¡Œçš„ä½¿ç”¨é¦–å…ˆï¼Œç¬¬ä¸€æ­¥å½“ç„¶æ˜¯æ‰“å¼€TEXå‘½ä»¤è¡Œï¼Œå¦‚æœå®‰è£…äº†TEXï¼š1$ texç„¶åä¼šæ˜¾ç¤ºï¼š12This is TeX, Version 3.14159265 (TeX Live 2019/W32TeX) (preloaded ...</p></div><div class="relate-post-cover"><a href="/ç¼–ç¨‹è¯­è¨€/Tex/TeXåŸºç¡€.html" title="TEXåŸºç¡€"><img class="lazy" src="/img/placeholder.jpg" data-src="/ç¼–ç¨‹è¯­è¨€/Tex/i/TeXif1.png" alt="TEXåŸºç¡€"></a></div></li><li><div class="relate-post-text"><a class="relate-post-title" href="/ç¼–ç¨‹è¯­è¨€/Tex/TeXå…¬å¼Tips.html" title="TEXå…¬å¼çŸ¥è¯†ç‚¹æ‹¾é—">TEXå…¬å¼çŸ¥è¯†ç‚¹æ‹¾é—</a><p class="relate-post-date"><i class="fa fa-calendar"></i> å››æœˆ 1æ—¥, 2020</p><p class="relate-post-content">\leftå’Œ\rightTEX æœ‰ä¸€ä¸ªå†…ç½®çš„æœºåˆ¶, èƒ½ç¡®å®šè¦å°è£…ä½ç»™å®šå…¬å¼æ‰€éœ€è¦çš„è¿™å¯¹åˆ†ç•Œç¬¦çš„é«˜åº¦; å› æ­¤, ä½ å¯ä»¥ä½¿ç”¨è¿™ ç§æ–¹æ³•, è€Œä¸ç”¨è‡ªå·±åœ¨\bigï¼Œ\biggæˆ–å…¶å®ƒä¸­ç­›é€‰ã€‚æ‰€è¦åšçš„åªæ˜¯ï¼š1\left&lt;delim1&gt...</p></div><div class="relate-post-cover"><a href="/ç¼–ç¨‹è¯­è¨€/Tex/TeXå…¬å¼Tips.html" title="TEXå…¬å¼çŸ¥è¯†ç‚¹æ‹¾é—"><img class="lazy" src="/img/placeholder.jpg" data-src="/img/cart_cover.jpg" alt="TEXå…¬å¼çŸ¥è¯†ç‚¹æ‹¾é—"></a></div></li><li><div class="relate-post-text"><a class="relate-post-title" href="/ç¼–ç¨‹è¯­è¨€/Node/nodejs-promise.html" title="nodejsä¸­çš„Promiseå¯¹è±¡">nodejsä¸­çš„Promiseå¯¹è±¡</a><p class="relate-post-date"><i class="fa fa-calendar"></i> åäºŒæœˆ 9æ—¥, 2019</p><p class="relate-post-content">Promiseæ˜¯ä¸€ç§æœ‰ä¸‰ä¸ªçŠ¶æ€çš„å¯¹è±¡ï¼ˆâ€œæ‰§è¡Œä¸­pendingâ€ã€â€œå®Œæˆresolveâ€ã€â€œå¤±è´¥rejectâ€ï¼‰ï¼Œæ„é€ Promiseå¯¹è±¡æ—¶çš„æ„é€ å‡½æ•°å‚æ•°æ˜¯ä¸€ä¸ªæœ‰ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«å¯¹åº”ç€Promiseå¯¹è±¡åˆ°è¾¾ä¸¤ä¸ªç»ˆç‚¹çŠ¶...</p></div><div class="relate-post-cover"><a href="/ç¼–ç¨‹è¯­è¨€/Node/nodejs-promise.html" title="nodejsä¸­çš„Promiseå¯¹è±¡"><img class="lazy" src="/img/placeholder.jpg" data-src="/ç¼–ç¨‹è¯­è¨€/Node/i/nodejs_4.png" alt="nodejsä¸­çš„Promiseå¯¹è±¡"></a></div></li><li><div class="relate-post-text"><a class="relate-post-title" href="/ç¼–ç¨‹è¯­è¨€/Node/nodejs-feature.html" title="nodejsé‡è¦ç‰¹æ€§">nodejsé‡è¦ç‰¹æ€§</a><p class="relate-post-date"><i class="fa fa-calendar"></i> åäºŒæœˆ 6æ—¥, 2019</p><p class="relate-post-content">å›è°ƒå‡½æ•°å¦‚æœçœ‹è§æŸä¸ªå‡½æ•°å®šä¹‰é•¿ä¸‹é¢è¿™æ ·ğŸ‘‡é‚£å®ƒå°±åº”è¯¥æ˜¯ä¸ªå¸¦å›è°ƒçš„å‡½æ•°ã€‚è¿™ç±»çš„å‡½æ•°ä¸€èˆ¬ä¸ºjså†…ç½®ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™éƒ½æ˜¯ä½œä¸ºä¸€ä¸ªæ–°çº¿ç¨‹è¿è¡Œçš„ã€‚1function some_function(param1,param2,callback)&#...</p></div><div class="relate-post-cover"><a href="/ç¼–ç¨‹è¯­è¨€/Node/nodejs-feature.html" title="nodejsé‡è¦ç‰¹æ€§"><img class="lazy" src="/img/placeholder.jpg" data-src="/ç¼–ç¨‹è¯­è¨€/Node/i/nodejs_1.jpg" alt="nodejsé‡è¦ç‰¹æ€§"></a></div></li><li><div class="relate-post-text"><a class="relate-post-title" href="/ç¼–ç¨‹è¯­è¨€/Shell/Shell-tips.html" title="Shellæ‹¾é—">Shellæ‹¾é—</a><p class="relate-post-date"><i class="fa fa-calendar"></i> åäºŒæœˆ 3æ—¥, 2019</p><p class="relate-post-content">getoptså’Œgetoptè¿™ä¸¤ä¸ªéƒ½æ˜¯ç”¨æ¥è§£æè„šæœ¬è¿è¡Œæ—¶çš„å‘½ä»¤è¡Œå‚æ•°çš„ã€‚ getoptsåªèƒ½å¤„ç†çŸ­é€‰é¡¹ï¼Œæ— æ³•å¤„ç†é•¿é€‰é¡¹ï¼Œæš‚ä¸ä»‹ç» getoptå¯ä»¥åŒæ—¶å¤„ç†çŸ­é€‰é¡¹å’Œé•¿é€‰é¡¹ã€‚getoptå‘½ä»¤ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„unixå‘½ä»¤ï¼Œä½†å®ƒåœ¨å¤§å¤šæ•°Lin...</p></div><div class="relate-post-cover"><a href="/ç¼–ç¨‹è¯­è¨€/Shell/Shell-tips.html" title="Shellæ‹¾é—"><img class="lazy" src="/img/placeholder.jpg" data-src="/img/cart_cover.jpg" alt="Shellæ‹¾é—"></a></div></li><li><div class="relate-post-text"><a class="relate-post-title" href="/ç¼–ç¨‹è¯­è¨€/Node/nodejs-tips.html" title="nodejsè¡¥å……çŸ¥è¯†">nodejsè¡¥å……çŸ¥è¯†</a><p class="relate-post-date"><i class="fa fa-calendar"></i> åä¸€æœˆ 29æ—¥, 2019</p><p class="relate-post-content">åœ¨æŒ‡å®šç›®å½•ä¸‹è¿è¡Œnpm éœ€æ±‚æ¥æºå†™äº†ä¸€ä¸ªéœ€è¦åœ¨æœ¬åœ°ä¿å­˜æ–‡ä»¶çš„é¡¹ç›®ï¼Œæƒ³è®©è¿™ä¸ªé¡¹ç›®èƒ½åœ¨ä»»æ„ä½ç½®ä¿å­˜æ–‡ä»¶ï¼Œä½†æ˜¯åˆä¸æƒ³å•ç‹¬ä¸ºè¿™ä¸€ä¸ªåŠŸèƒ½å•ç‹¬æé…ç½®æ–‡ä»¶ï¼Œäºæ˜¯ä¹åœ¨ä»£ç é‡Œé¢ç”¨process.CWD()æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œä½¿ä¿å­˜ç›®å½•ä¸ºç¨‹åºå®é™…è¿è¡Œçš„ç›®å½•ã€‚...</p></div><div class="relate-post-cover"><a href="/ç¼–ç¨‹è¯­è¨€/Node/nodejs-tips.html" title="nodejsè¡¥å……çŸ¥è¯†"><img class="lazy" src="/img/placeholder.jpg" data-src="/img/cart_cover.jpg" alt="nodejsè¡¥å……çŸ¥è¯†"></a></div></li></ul></div></div><div class="investment-content-list"><div class="layout-comment"><div>Please check the comment setting in config.yml of hexo-theme-Annie!</div></div></div><div class="investment-content-list"><div class="layout-share"><div class="social-share"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css"><script async src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script></div></div></div></div></div></div><script src="/plugin/clipboard/clipboard.js"></script><script>function codePreprocessing(){$("#article-content .highlight").each(function(){$(this).wrap('<div id="post-code"></div>')}),$("#article-content #post-code").each(function(){$(this).prepend('<nav class="copy-nav"><span><i class="code-language"></i></span></nav>')}),$("#article-content .copy-nav").each(function(){var t=$(this).next().attr("class"),e=9<t.length&&null!=t?t.substr(10):"none";$(this).find(".code-language").text(e),$(this).append('<span class="copy-btn"><i class="fa fa-copy" aria-hidden="true"></i></span>')})}function codeCopy(){$("#article-content #post-code").each(function(t){var e="codeCopy-"+t,n=$(this).find(".code"),o=$(this).find(".copy-btn");n.attr("id",e),o.attr("data-clipboard-target-id",e)});var t=new ClipboardJS(".copy-btn",{target:function(t){return document.getElementById(t.getAttribute("data-clipboard-target-id"))}});t.on("success",function(t){var e;t.clearSelection(),console.info("Action:",t.action),console.info("Trigger:",t.trigger),(e=t.trigger).setAttribute("aria-label","Copied!"),e.setAttribute("class","copy-btn copy-status"),setTimeout(function(){e.setAttribute("class","copy-btn")},2e3)}),t.on("error",function(t){console.error("Action:",t.action),console.error("Trigger:",t.trigger)})}$(".layout-post").length&&(codePreprocessing(),codeCopy())</script><link rel="stylesheet" href="/plugin/fancybox/jquery.fancybox.css"><script src="/plugin/fancybox/jquery.fancybox.js"></script><script type="text/javascript">var titleID=$(".article-title a"),imageID=$(".article-content img"),videoID=$(".article-content video"),postTitle=titleID.text()?titleID.text():"No post title!";imageID.each(function(){var t=$(this).attr("src"),a=$(this).attr("alt")?$(this).attr("alt"):"No image description!";$(this).wrap('<a data-fancybox="gallery" data-caption=" ã€Š '+postTitle+" ã€‹ "+a+' "  href=" '+t+' "> </a>')}),videoID.each(function(){var t=$(this).attr("src");$(this).wrap('<a data-fancybox href=" '+t+' "> </a>')}),$("#layout-post").length&&$('[data-fancybox="gallery"]').fancybox({loop:!0,buttons:["zoom","share","slideShow","fullScreen","thumbs","close"],protect:!1})</script></main><footer><div class="social"><ul><li><a href="http://github.com/yindaheng98" target="_blank"><i class="fa fa-github"></i></a></li><li><a href="http://github.com/yindaheng98" target="_blank"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/yindaheng98" target="_blank"><i class="fa fa-pinterest"></i></a></li><li><a href="http://github.com/yindaheng98" target="_blank"><i class="fa fa-instagram"></i></a></li><li><a href="http://github.com/yindaheng98" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li></ul></div><div class="copyright"><p>&copy;2017 - 2020, content by Howard Yin. All Rights Reserved.<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv">æœ¬æ–‡æ€»é˜…è¯»é‡<span id="busuanzi_value_page_pv"></span>æ¬¡</span></p><p><a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> Theme <a href="https://github.com/Sariay/hexo-theme-Annie" title="Annie" target="_blank" rel="noopener">Annie</a> by Sariay. <a href="javascript:zh_tran('s');" class="zh_click" id="zh_click_s">ç®€ä½“</a> <a href="javascript:zh_tran('t');" class="zh_click" id="zh_click_t">ç¹é«”</a></p></div></footer><script src="/plugin/motto/motto.js"></script><script type="text/javascript">$(".motto").html(getMingYanContent())</script><div id="totop"><a href="javascript:;" name="TOTOP" class="fa fa-arrow-up"></a></div><script src="/plugin/vibrant/vibrant.js"></script><script src="/plugin/chinese/chinese.js"></script><script src="/plugin/imgLazyLoader/yall.min.js"></script><script src="/plugin/imgResize/jquery.resizeimagetoparent.min.js"></script><script src="/plugin/nicescroll/jquery.nicescroll.js"></script><script src="/js/resizediv.js"></script><script src="/js/main.js"></script><script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></body></html>