function init(t){var e=$(".leancloud_visitors").attr("data-url").trim()||$(".leancloud_likes").attr("data-url").trim(),o=$(".leancloud_visitors").attr("data-title").trim()||$(".leancloud_likes").attr("data-title").trim(),i=new AV.Query(t);i.equalTo("url",e),i.find().then(function(i){if(i.length>0)console.log("Object instance already exists.");else{var n=new t;n.set("url",e),n.set("title",o),n.set("visitors",0),n.set("likes",0),n.save().then(function(t){console.log("Succed to create."),console.log("New object created with objectId: "+t.id)},function(t){console.log("Failed to create!"),console.error("Failed to create new object, with error message: "+t.message)})}},function(t){console.log("Error:"+t.code+" "+t.message)})}function addVisitors(t){var e=$(".leancloud_visitors").attr("data-url").trim(),o=($(".leancloud_visitors").attr("data-title").trim(),$(".leancloud_visitors_count").attr("id").trim()),i=new AV.Query(t);i.equalTo("url",e),i.find().then(function(t){if(t.length>0){var e=t[0];e.increment("visitors"),e.fetchWhenSave(!0),e.save().then(function(t){var e=t.get("visitors");$(document.getElementById(o)).text(e),console.log("Succed to add visitors."),console.log("New visitors: "+t.id+" "+t.get("url")+" "+t.get("visitors"))},function(t){console.log("Failed to add visitors!"),console.log("Error:"+t.code+" "+t.message)})}},function(t){console.log("Error:"+t.code+" "+t.message)})}function addLikes(t){var e=$(".leancloud_likes").attr("data-url").trim(),o=($(".leancloud_likes").attr("data-title").trim(),$(".leancloud_likes_count").attr("id").trim()),i=new AV.Query(t);i.equalTo("url",e),i.find().then(function(t){if(t.length>0){var e=t[0];e.increment("likes"),e.fetchWhenSave(!0),e.save().then(function(t){var e=t.get("likes");$(document.getElementById(o)).text(e),console.log("Succed to add likes."),console.log("New likes: "+t.id+" "+t.get("url")+" "+t.get("likes"))},function(t){console.log("Failed to add likes!"),console.log("Error:"+t.code+" "+t.message)})}},function(t){console.log("Error:"+t.code+" "+t.message)})}function showVisitors(t){var e=new AV.Query(t),o=[];$(".leancloud_visitors").each(function(){o.push($(this).attr("data-url").trim())}),e.containedIn("url",o),e.find().then(function(t){if(0!==t.length){for(var e=0;e<t.length;e++){var i=t[e],n=i.get("url"),l=i.get("visitors"),s=document.getElementById(n+"_visitors");$(s).find(".leancloud_visitors_count").text(l)}for(e=0;e<o.length;e++){n=o[e],s=document.getElementById(n+"_visitors");""==$(s).find(".leancloud_visitors_count").text()&&$(s).find(".leancloud_visitors_count").text(0)}}else $(".leancloud_visitors").find(".leancloud_visitors_count").text(0)},function(t){console.log("Error: "+t.code+" "+t.message)})}function showLikes(t){var e=new AV.Query(t),o=[];$(".leancloud_likes").each(function(){o.push($(this).attr("data-url").trim())}),e.containedIn("url",o),e.find().then(function(t){if(0!==t.length){for(var e=0;e<t.length;e++){var i=t[e],n=i.get("url"),l=i.get("likes"),s=document.getElementById(n+"_likes");$(s).find(".leancloud_likes_count").text(l)}for(e=0;e<o.length;e++){n=o[e],s=document.getElementById(n+"_likes");""==$(s).find(".leancloud_likes_count").text()&&$(s).find(".leancloud_likes_count").text(0)}}else $(".leancloud_likes").find(".leancloud_likes_count").text(0)},function(t){console.log("Error: "+t.code+" "+t.message)})}function topNPost(t,e){var o=new AV.Query("Counter");o.notEqualTo("id",0),o.descending("visitors"),o.limit(e),o.find().then(function(t){var o=e>t.length?t.length:e;if(o>0){for(var i=0;i<o;i++){var n=t[i],l="<ul class='topN-post-list'><li class='topN-post-item'><span class='item-topNumber'>TOP"+(i+1)+"</span><a class='item-title' href='"+n.get("url")+"'>"+n.get("title")+"</a><i class='item-visitors'>【文章热度:"+n.get("visitors")+"℃】</i></li></ul>";$("#topN").append(l)}var s=$(".topN-title").attr("data-title").trim();$(".topN-title").text(s+"("+o+" posts)")}console.log("Succed to find topNPost.")},function(t){console.log("Error: "+t.code+" "+t.message)})}function getCookie(t){for(var e=t+"=",o=document.cookie.split(";"),i=0;i<o.length;i++){var n=o[i].trim();if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""}function getCookieById(t,e){for(var o=t+"=",i=document.cookie.split(";"),n="",l=0;l<i.length;l++){0==(r=i[l].trim()).indexOf(o)&&(n=r.substring(o.length,r.length))}if(""!=n){var s=n.split(",");for(l=0;l<s.length;l++){var r;if(0==(r=s[l].trim()).indexOf(e))return!0}}return""}function addCookieById(t,e,o){var i=getCookie(t);if(""==i)i=e;else{for(var n=i.split(","),l=0,s=0;s<n.length;s++){if(0==n[s].trim().indexOf(e)){l=1;break}}0==l&&(i+=","+e)}var r=new Date;r.setTime(r.getTime()+24*o*60*60*1e3);var a="expires="+r.toGMTString();document.cookie=t+"="+i+"; "+a}function AnnieLeancloud(t,e){AV.initialize(t,e);var o=AV.Object.extend("Counter");return $(".layout-post").length?function(){if(init(o),1==$(".leancloud_visitors").length&&addVisitors(o),$(".leancloud_likes").length){var t=$(".leancloud_likes").attr("data-url").trim(),e=getCookieById("star",t);""!=e&&$(".leancloud_likes").addClass("heartAnimation"),showLikes(o),$(".layout-post").on("click",".leancloud_likes",function(){"unlike"===$(this).attr("rel")&&""==e&&(addLikes(o),$(this).addClass("heartAnimation").attr("rel","like"),addCookieById("star",t,.5))})}}():($(".layout-pure").length||$(".layout-cart").length)&&$(".post-title").length>=1?($(".leancloud_visitors").length&&showVisitors(o),void($(".leancloud_likes").length&&showLikes(o))):void 0}